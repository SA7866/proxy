{% extends "store/base.html" %}
{% block title %}Payment • Proxy{% endblock %}

{% block content %}
<h1 class="page-title">Payment</h1>

<div class="grid" style="grid-template-columns: 1.1fr 0.9fr;">

  <!-- LEFT: PAYMENT FORM -->
  <div class="card">
    <h3>Payment details</h3>

    <p class="desc">
      This is a demo payment screen for the prototype.
      No real card data is processed or stored.
    </p>

    <form method="post">
      {% csrf_token %}

      <div class="form-group">
        <label>Card number</label>
        <input
          class="input-field"
          type="text"
          name="card_number"
          id="card_number"
          placeholder="1234 5678 9012 3456"
          maxlength="19"
          inputmode="numeric"
          autocomplete="cc-number"
          required
        />
      </div>

      <div class="grid" style="grid-template-columns: 1fr 1fr; gap:12px;">
        <div class="form-group">
          <label>Expiry (MM/YY)</label>
          <input
            class="input-field"
            type="text"
            name="expiry"
            id="expiry"
            placeholder="MM/YY"
            maxlength="5"
            inputmode="numeric"
            autocomplete="cc-exp"
            required
          />
        </div>

        <div class="form-group">
          <label>CVV</label>
          <input
            class="input-field"
            type="password"
            name="cvv"
            id="cvv"
            placeholder="123"
            maxlength="3"
            inputmode="numeric"
            autocomplete="cc-csc"
            required
          />
        </div>
      </div>

      <button class="btn" type="submit" style="margin-top:14px;">
        Pay £{{ order.total_amount }}
      </button>
    </form>
  </div>

  <!-- RIGHT: ORDER SUMMARY -->
  <div class="card">
    <h3>Order Summary</h3>

    <p><b>Order #{{ order.id }}</b></p>
    <p>{{ order.full_name }}</p>

    <p class="price">
      Total: £{{ order.total_amount }}
    </p>

    <p>Status: <b>{{ order.status }}</b></p>
  </div>

</div>

<!-- Demo-only formatting JS -->
<script>
  const cardInput = document.getElementById("card_number");
  const expiryInput = document.getElementById("expiry");
  const cvvInput = document.getElementById("cvv");

  if (cardInput) {
    cardInput.addEventListener("input", () => {
      let v = cardInput.value.replace(/\D/g, "").slice(0, 16);
      cardInput.value = v.replace(/(.{4})/g, "$1 ").trim();
    });
  }

  if (expiryInput) {
    expiryInput.addEventListener("input", () => {
      let v = expiryInput.value.replace(/\D/g, "").slice(0, 4);
      if (v.length >= 3) {
        v = v.slice(0, 2) + "/" + v.slice(2);
      }
      expiryInput.value = v;
    });
  }

  if (cvvInput) {
    cvvInput.addEventListener("input", () => {
      cvvInput.value = cvvInput.value.replace(/\D/g, "").slice(0, 3);
    });
  }
</script>
{% endblock %}
